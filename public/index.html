<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Signal Chat UI</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --signal-blue:#2C6BED;
  --ios-curve:cubic-bezier(0.4,0,0.2,1);
}
body{
  font-family:'Inter',sans-serif;
  background:#000;height:100dvh;margin:0;overflow:hidden;
  display:flex;align-items:center;justify-content:center;
}
.bg-signal-blue{background-color:var(--signal-blue);}
.scrollbar-hide::-webkit-scrollbar{display:none;}
#main-app{display:flex;width:100%;height:100%;background:#fff;overflow:hidden;}
#sidebar,#main-chat{height:100%;transition:transform .5s var(--ios-curve),opacity .4s ease;}
@media(max-width:767px){
  #sidebar{width:100%;position:absolute;z-index:10}
  #main-chat{width:100%;position:absolute;transform:translateX(100%);z-index:20}
  .view-list #sidebar{transform:translateX(0)}
  .view-chat #sidebar{transform:translateX(-25%);opacity:.9}
  .view-chat #main-chat{transform:translateX(0)}
}
@media(min-width:768px){
  #main-app{height:95dvh;max-width:1280px;border-radius:1.25rem;border:1px solid #e5e7eb}
  #sidebar{width:360px;border-right:1px solid #f3f4f6}
  #main-chat{flex:1;transform:none!important}
}
.btn-touch{transition:.15s ease}
.btn-touch:active{transform:scale(.92);opacity:.7}
.chat-list-item{transition:.2s ease}
.chat-list-item:active{transform:scale(.98);background:#f0f2f5}
.active-chat{background:#e8effd!important}
.message-appear{animation:popIn .3s cubic-bezier(.175,.885,.32,1.2)}
@keyframes popIn{
  from{opacity:0;transform:scale(.9) translateY(10px)}
  to{opacity:1;transform:scale(1) translateY(0)}
}
</style>
</head>

<body class="view-chat">

<div id="main-app">

<!-- CHAT -->
<main id="main-chat" class="flex flex-col w-full">
<header class="h-20 flex items-center px-6 border-b">
<h2 class="font-bold text-lg">General</h2>
</header>

<div id="messages-container"
 class="flex-1 overflow-y-auto px-6 py-6 space-y-4 scrollbar-hide bg-white">
</div>

<footer class="p-4 border-t">
<div class="flex gap-3">
<textarea id="message-input"
 placeholder="Signal Message"
 rows="1"
 class="flex-1 bg-gray-50 rounded-2xl px-4 py-2 resize-none"></textarea>
<button id="send-btn"
 class="btn-touch w-12 h-12 bg-signal-blue text-white rounded-full flex items-center justify-center">
âž¤
</button>
</div>
</footer>
</main>
</div>

<!-- ðŸ”¥ FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
/* ðŸ”¥ FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "YOUR_API_KEY",
  projectId: "YOUR_PROJECT_ID"
});
const db = firebase.firestore();

/* ðŸ”¥ UNIQUE USER ID (LOCAL, NO LOGIN) */
const MY_ID = localStorage.getItem("signal_id") || crypto.randomUUID();
localStorage.setItem("signal_id", MY_ID);

/* UI ELEMENTS */
const messagesContainer = document.getElementById('messages-container');
const messageInput = document.getElementById('message-input');
const sendBtn = document.getElementById('send-btn');
const CHAT_ID = "general";

/* ðŸ”¥ REALTIME LISTENER */
db.collection("public")
  .doc(CHAT_ID)
  .collection("messages")
  .orderBy("createdAt")
  .onSnapshot(snap => {

    messagesContainer.innerHTML = `
      <div class="flex justify-center mb-4">
        <span class="text-xs text-gray-400">SIGNAL MESSAGE</span>
      </div>`;

    snap.forEach(doc => {
      const m = doc.data();
      const isMe = m.sender === MY_ID;

      messagesContainer.insertAdjacentHTML(
        "beforeend",
        isMe
          ? `
          <div class="flex justify-end message-appear">
            <div class="bg-signal-blue text-white px-4 py-3 rounded-[1.25rem] rounded-br-none max-w-[80%]">
              ${m.text}
            </div>
          </div>`
          : `
          <div class="flex justify-start message-appear">
            <div class="bg-gray-100 text-gray-800 px-4 py-3 rounded-[1.25rem] rounded-bl-none max-w-[80%]">
              ${m.text}
            </div>
          </div>`
      );
    });

    messagesContainer.scrollTop = messagesContainer.scrollHeight;
  });

/* ðŸ”¥ SEND MESSAGE */
sendBtn.onclick = async () => {
  const text = messageInput.value.trim();
  if (!text) return;

  await db.collection("public")
    .doc(CHAT_ID)
    .collection("messages")
    .add({
      text,
      sender: MY_ID,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

  messageInput.value = '';
  messageInput.style.height = 'auto';
};

/* AUTO RESIZE */
messageInput.addEventListener('input', () => {
  messageInput.style.height = 'auto';
  messageInput.style.height = messageInput.scrollHeight + 'px';
});
</script>

</body>
</html>
